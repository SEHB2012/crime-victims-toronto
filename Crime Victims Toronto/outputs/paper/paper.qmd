---
title: "Are some women more susceptible to crime than others in Toronto?"
subtitle: "A visualisation of crime rates over the years, and the ages they affect most"
author: 
  - Sehar Bajwa
thanks: "Code and data are available at: https://github.com/SEHB2012/crime-victims-toronto"
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
toc: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(palmerpenguins)
library(tidyverse)
library(dplyr)
library(tidyr)
library(knitr)
library(kableExtra)

```


# Introduction

You can and should cross-reference sections and sub-sections. 

The remainder of this paper is structured as follows. @sec-data....



# Data {#sec-data}
The first step is to construct a relevant dataset derived from the Police Annual Statistical report on crime victims. This section delves into the characteristics of note and outlines the process undertaken to create a ready-to-analyse dataset, including addressing missing values and standardizing variable names.
## Data characteristics
Published by the Toronto Police service on the Toronto Open Data Portal, the original dataset covers all crimes committed against the person, including those deemed unfounded post investigation. Updated annually, the entries are filtered by the reported year, and each year is associated with the following features : type of crime, age cohort of victim, gender, and counts of the same crime.
Note that the dataset is not impervious to missing/incomplete data across several categories, and while any incomplete datapoint has been discounted, this causes serious implications for the analysis and is examined later.
The original dataset features 1111 datapoints across 9 variables.
 Age_cohort is a defining feature of this dataset, and refers to one of 8 age bins that are as follows: ">12", "12 to 17", "18 to 24", "25 to 34","35 to 44","45 to 54","55 to 64","65+". Accordingly, efforts were made to attribute recognisable labels to these cohorts, but there was admittedly difficulty distinguishing between the middle aged adults that arguable spanned three of the 9 age cohorts. Therefore, the original identifiers were retained.
## Data cleanup and processing 
R (R Core Team 2021) was the language and environment used for the bulk of this analysis, alongside the dplyr (Wickham et al. 2021),tidyverse (Wickham et al. 2019), janitor (Firke et al. 2021),  heatmap(cite). 

I began with cleaning up the data after downloading it using the opendatatoronto package. Following are the steps involved in the primary cleanup stage: 
Cleaning and standardising column names 
Selecting relevant categories, these being report_year,subtype,sex, age_cohort,count
Removing datapoints with unknown/missing data 
Filtering to only female victims.


```{r dataextract, echo=FALSE, message=FALSE}
# create a table showing the first ten rows of the cleaned data
clean_crimesdata <- read_csv(here::here("Crime Victims Toronto/inputs/data/final_crimedata_toronto.csv"))
  col_types = cols(.default = "c")

clean_crimesdata %>%
  slice(1:10) %>%
  kable(
    caption = "Extracting the first ten rows from the Crime victims data",
col.names=c("Year", "Type of Crime", "Age cohort", "Count"),
linesep = "", digits = 1, booktabs=T) %>%
  kable_styling(latex_options = "HOLD_position", font_size = 10)
tail(clean_crimesdata)
```

Talk more about it.

And also planes (@fig-planes). (You can change the height and width, but don't worry about doing that until you have finished every other aspect of the paper - Quarto will try to make it look nice and the defaults usually work well once you have enough text.)

```{r}
#| label: fig-planes
#| fig-cap: Relationship between wing length and width
#| echo: false
#| warning: false
#| message: false

#analysis_data <- read_csv(here::here("outputs/data/analysis_data.csv"))

```

Talk way more about it. 



# Visualisation

The goal of our modelling strategy is twofold. Firstly,...

Here we briefly describe the Bayesian analysis model used to investigate... Background details and diagnostics are included in [Appendix -@sec-model-details].

## Changing crime trends in Toronto over the years 
### 
### Discussion

Define $y_i$ as the number of seconds that the plane remained aloft. Then $\beta_i$ is the wing width and $\gamma_i$ is the wing length, both measured in millimeters.  

\begin{align} 
y_i|\mu_i, \sigma &\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &= \alpha + \beta_i + \gamma_i\\
\alpha &\sim \mbox{Normal}(0, 2.5) \\
\beta &\sim \mbox{Normal}(0, 2.5) \\
\gamma &\sim \mbox{Normal}(0, 2.5) \\
\sigma &\sim \mbox{Exponential}(1)
\end{align}

We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.


### Model justification

We expect a positive relationship between the size of the wings and time spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.


# Results

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false


```

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false

```




# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]


```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2

```



\newpage


# References
